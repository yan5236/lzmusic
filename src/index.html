<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: blob: https://api.bilibili.com https://*.hdslb.com https://*.bilivideo.com; img-src 'self' data: blob: https: http:; media-src 'self' blob: data: https:; connect-src 'self' http://localhost:* https://api.bilibili.com https://*.bilibili.com https://music.163.com http://mobileservice.kugou.com http://krcs.kugou.com http://lyrics.kugou.com https://songsearch.kugou.com https://*.kugou.com https://api.vkeys.cn https://*.vkeys.cn https://c.y.qq.com https://y.qq.com https://*.qq.com https://www.kuwo.cn https://*.kuwo.cn wss:; script-src 'self' 'unsafe-inline';">
  <title>LZ Music</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/sidebar.css">
  <link rel="stylesheet" href="styles/player.css">
  <link rel="stylesheet" href="styles/modal.css">
  <link rel="stylesheet" href="styles/playlist-management.css">
  <link rel="stylesheet" href="styles/lyrics-settings.css">
</head>
<body>
  <!-- 主容器 -->
  <div class="app-container">
    <!-- 侧边栏 -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h1 class="app-title">LZ Music</h1>
        <button class="sidebar-toggle" id="sidebarToggle">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </button>
      </div>
      
      <nav class="sidebar-nav">
        <ul class="nav-list">
          <li class="nav-item active" data-page="home">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            <span>首页</span>
          </li>
          <li class="nav-item" data-page="search">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
            <span>搜索</span>
          </li>
          <li class="nav-item" data-page="playlist">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/>
              <path d="M14 2v6h6"/>
              <path d="M16 13H8"/>
              <path d="M16 17H8"/>
              <path d="M10 9H8"/>
            </svg>
            <span>歌单</span>
          </li>
          <li class="nav-item" data-page="settings">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
            </svg>
            <span>设置</span>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- 主内容区域 -->
    <main class="main-content" id="mainContent">
      <!-- 首页 -->
      <div class="page active" id="homePage">
        <div class="page-header">
          <h2>音乐首页</h2>
        </div>
        <div class="content-grid">
          <!-- 最近播放区域 -->
          <div class="recent-section" id="recentSection" style="display: none;">
            <div class="section-header">
              <h3>最近播放</h3>
              <button class="section-action-btn" id="clearHistoryBtn">清空历史</button>
            </div>
            <div class="music-grid recent-music-grid" id="recentMusic">
              <!-- 最近播放内容 -->
            </div>
          </div>
          
          <!-- 推荐区域 -->
          <div class="recommendation-section">
            <div class="section-header">
              <h3>音乐推荐</h3>
              <button class="section-action-btn" id="refreshRecommendationsBtn">刷新推荐</button>
            </div>
            <div class="music-grid" id="recommendedMusic">
              <!-- 推荐内容将通过 JavaScript 动态加载 -->
            </div>
          </div>
        </div>
      </div>

      <!-- 搜索页 -->
      <div class="page" id="searchPage">
        <div class="search-container">
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="搜索音乐或输入BV号..." />
            <button id="searchBtn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
            </button>
          </div>
          <div class="search-results" id="searchResults">
            <!-- 搜索结果将在这里显示 -->
          </div>
        </div>
      </div>

      <!-- 歌单页 -->
      <div class="page" id="playlistPage">
        <div class="page-header">
          <h2>我的歌单</h2>
          <button class="create-playlist-btn">创建歌单</button>
        </div>
        
        <div class="playlist-grid" id="playlistGrid">
          <!-- 歌单内容 -->
        </div>
      </div>

      <!-- 歌单详情页 -->
      <div class="page" id="playlistDetailPage">
        <div class="page-header">
          <button class="back-btn" id="backToPlaylistsBtn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
            返回歌单
          </button>
          <div class="playlist-detail-info">
            <h2 id="playlistDetailTitle">歌单名称</h2>
            <p id="playlistDetailMeta">0 首歌曲 · 创建于 --</p>
          </div>
          <div class="playlist-detail-actions">
            <button class="play-all-btn" id="playAllDetailBtn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
              </svg>
              播放全部
            </button>
            <button class="edit-playlist-main-btn" id="editPlaylistMainBtn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
              </svg>
              编辑歌单
            </button>
            <button class="manage-toggle-btn" id="manageDetailToggleBtn" data-mode="view">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
              </svg>
              <span>管理歌单</span>
            </button>
          </div>
        </div>
        
        <!-- 管理工具栏 (默认隐藏) -->
        <div class="playlist-management-toolbar" id="playlistDetailToolbar" style="display: none;">
          <div class="toolbar-left">
            <button class="toolbar-btn select-all-btn" id="selectAllDetailBtn"><span>全选</span></button>
            <button class="toolbar-btn select-none-btn" id="selectNoneDetailBtn"><span>取消选择</span></button>
            <span class="selected-count-display">已选择 <span class="selected-count" id="selectedDetailCount">0</span> 首歌曲</span>
          </div>
          <div class="toolbar-right">
            <button class="toolbar-btn add-songs-btn" id="addSongsDetailBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
              <span>添加歌曲</span>
            </button>
            <button class="toolbar-btn batch-remove-btn" id="batchRemoveDetailBtn" disabled>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
              </svg>
              <span>批量删除</span>
            </button>
          </div>
        </div>
        
        <div class="playlist-detail-songs">
          <div class="songs-list" id="playlistDetailSongs">
            <!-- 歌曲列表将在这里渲染 -->
          </div>
        </div>
      </div>

      <!-- 设置页 -->
      <div class="page" id="settingsPage">
        <div class="page-header">
          <h2>设置</h2>
        </div>
        <div class="settings-content">
          <div class="setting-group">
            <h3>播放设置</h3>
            <div class="setting-item">
              <label for="autoPlay">自动播放下一首</label>
              <input type="checkbox" id="autoPlay" checked>
            </div>
            <div class="setting-item">
              <label for="quality">音质设置</label>
              <select id="quality">
                <option value="high">高音质</option>
                <option value="medium" selected>标准音质</option>
                <option value="low">省流模式</option>
              </select>
            </div>
          </div>
          
          <div class="setting-group">
            <h3>网易云音乐API设置</h3>
            <div class="setting-item">
              <label for="neteaseApiEnabled">启用网易云API</label>
              <input type="checkbox" id="neteaseApiEnabled" checked>
            </div>
            <div class="setting-item">
              <p style="color: #666; font-size: 14px;">
                使用网易云音乐官方API模块，无需启动独立服务器。
              </p>
            </div>
          </div>
          
          <div class="setting-group">
            <h3>关于</h3>
            <p>LZ Music v1.0.0</p>
            <p>基于 Bilibili API 的音乐播放器</p>
          </div>
        </div>
      </div>
    </main>

    <!-- 播放栏 -->
    <div class="player-bar" id="playerBar">
      <div class="player-info">
        <div class="cover-container">
          <img src="" alt="封面" class="cover-image" id="coverImage">
          <div class="cover-placeholder">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
            </svg>
          </div>
        </div>
        <div class="song-info">
          <div class="song-title" id="songTitle">选择一首歌曲</div>
          <div class="song-artist" id="songArtist">UP主</div>
        </div>
      </div>

      <div class="player-controls">
        <button class="control-btn" id="prevBtn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
          </svg>
        </button>
        <button class="control-btn play-btn" id="playBtn">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" class="play-icon">
            <path d="M8 5v14l11-7z"/>
          </svg>
          <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" class="pause-icon" style="display:none;">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
          </svg>
        </button>
        <button class="control-btn" id="nextBtn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 18h2V6h-2v12zM6 18l8.5-6L6 6v12z"/>
          </svg>
        </button>
      </div>

      <div class="player-progress">
        <span class="time-current" id="currentTime">0:00</span>
        <div class="progress-container">
          <input type="range" class="progress-bar" id="progressBar" min="0" max="100" value="0">
        </div>
        <span class="time-total" id="totalTime">0:00</span>
      </div>

      <div class="player-extras">
        <div class="volume-control">
          <button class="control-btn volume-btn" id="volumeBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="volume-on">
              <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
            </svg>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="volume-off" style="display:none;">
              <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
            </svg>
          </button>
          <div class="volume-slider-container" id="volumeSliderContainer">
            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="100">
          </div>
        </div>
        
        <button class="control-btn mode-btn" id="modeBtn" data-mode="sequence">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="sequence-icon">
            <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
          </svg>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="random-icon" style="display:none;">
            <path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/>
          </svg>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="repeat-icon" style="display:none;">
            <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4zm-4-2V9h-1l-2 1v1h1.5v4H13z"/>
          </svg>
        </button>

        <button class="control-btn playlist-btn" id="playlistBtn" title="播放列表">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
          </svg>
        </button>
        
        <button class="control-btn expand-btn" id="expandBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M7.41 7.84L12 12.42l4.59-4.58L18 9.25l-6 6-6-6z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- 播放列表面板 -->
    <div class="playlist-panel" id="playlistPanel">
      <div class="playlist-panel-header">
        <h3>播放列表</h3>
        <div class="playlist-panel-actions">
          <span class="playlist-count" id="playlistCount">0首歌曲</span>
          <button class="control-btn clear-playlist-btn" id="clearPlaylistBtn" title="清空列表">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
            </svg>
          </button>
          <button class="control-btn close-panel-btn" id="closePanelBtn" title="关闭">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="playlist-panel-content" id="playlistPanelContent">
        <!-- 播放列表内容 -->
      </div>
    </div>

    <!-- 全屏播放界面 -->
    <div class="player-modal" id="playerModal">
      <div class="modal-header">
        <button class="close-btn" id="closeModalBtn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      <div class="modal-content">
        <div class="modal-left">
          <div class="large-cover">
            <img src="" alt="封面" id="modalCoverImage">
            <div class="cover-placeholder">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
              </svg>
            </div>
          </div>
          <div class="modal-song-info">
            <h2 class="modal-song-title" id="modalSongTitle">歌曲标题</h2>
            <p class="modal-song-artist" id="modalSongArtist">UP主</p>
          </div>
        </div>
        <div class="modal-right">
          <div class="lyrics-container">
            <div class="lyrics-content" id="lyricsContent">
              <p>暂无歌词</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 播放界面左下角的设置按钮 -->
      <div class="modal-bottom-controls">
        <button class="lyrics-settings-btn" id="lyricsSettingsBtn" title="歌词设置">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
          </svg>
          <span>歌词设置</span>
        </button>
      </div>
    </div>
  </div>

  <!-- 音频元素 -->
  <audio id="audioPlayer" preload="metadata"></audio>

  <!-- JavaScript 模块 -->
  <script src="js/utils/storage.js"></script>
  <script src="js/utils/LyricsDB.js"></script>
  <script src="js/api/bilibili.js"></script>
  <script src="js/api/netease.js"></script>
  <script src="js/components/PageSelector.js"></script>
  <script src="js/components/LyricsSettings.js"></script>
  <script src="js/components/Sidebar.js"></script>
  <script src="js/components/Player.js"></script>
  <script src="js/components/Search.js"></script>
  <script src="js/components/PlaylistManager.js"></script>
  <script src="js/components/Playlist.js"></script>
  <script src="js/app.js"></script>
</body>
</html> 